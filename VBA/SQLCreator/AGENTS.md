# AGENTS.md
## 出力言語
このリポジトリに関するすべての説明・要約は日本語で記述してください。コードは変更せず、そのまま出力してください。

## 作業概要
Excelシートの内容からDBのDROP TABLE, CREATE TABLEのSQLを作成する。

## 言語
Excel VBA

## 仕様詳細  Version 2.3.0

# ユーザー入力につて
1. ユーザーからの入力はExcelのシート上から行う。

2. Excelのシートには以下2つのシートがある。
- mainシート
- typeシート

3. mainシートに以下がある。
- 作成ボタン
- 指示表

4. typeシートには以下がある。
- 数値■DECIMAL■NUMBER
- 文字列■VARCHAR■VARCHAR2■NVARCHAR■CHAR
- 日付■DATE
- 時刻■TIME
- 日時■TIMESTAMP
- ■は便宜上タブ文字を表す。(以降同様)
- "数値"はB3セル、"日時"はB7セル

5. mainシートの指示表には以下のようなヘッダ行がある。
- No■対象■定義ファイルパス■シート名■テーブル名■カラム名開始セル■型カラム開始セル■整数桁カラム開始セル■小数桁カラム開始セル■PKカラム開始セル■NotNullカラム開始セル■DBMS■対象■データファイルパス■シート名■テーブル名■データ開始セル■■エラーメッセージ
- "No"はB10セル、"エラーメッセージ"はT10セル

6. mainシートの指示表のヘッダ行の下の行(B11～R11セル)から下にはユーザーの指示を記載する。

7. ユーザーの指示はB列に空セルを検知するまで下方向に探索する。

8. ユーザーの指示の各列に設定可能な指示は以下の通りとする。
- (1) No列：1からの連番とするが空セル以外であれば許容する。この列（B列）が空セルを検知した時点でSQL作成処理は終了とする。
- (2) 対象列："〇"or空セルを入力。"〇"の場合は「テーブル定義」の行を有効として"〇"以外であれば無効とする。無効の場合はSQL作成処理は行わずにその行はスキップする。
- (3) 定義ファイルパス列：ユーザが作成したDBテーブル定義(Excelファイル)のファイルパスを絶対パスで指定する。対象列かつ不正パス等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
空の場合は無視して次の行に進む。
- (4) シート名列：(3)のファイルパス列のパスが正当な場合、そのExcelファイルのシート名を指定する。シート毎にDBテーブル定義が指定される。対象列かつ空、不正シート名等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (5) テーブル名列：作成するテーブルのテーブル名を指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (6) カラム名開始セル列：(4)のシート名列で指定したシート名にはテーブル定義表（後述）が記載されているが、その表のカラム名が開始されるセルをA1形式で指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
テーブル定義表から読み取った型がtypeシートに記載されていない場合もエラーとする。
- (7) 型カラム開始セル列：(4)のシート名列で指定したシート名にはテーブル定義表（後述）が記載されているが、その表の型カラムが開始されるセルをA1形式で指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (8) 整数桁カラム開始セル列：(4)のシート名列で指定したシート名にはテーブル定義表（後述）が記載されているが、その表の整数桁カラムが開始されるセルをA1形式で指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (9) 小数桁カラム開始セルセル列：(4)のシート名列で指定したシート名にはテーブル定義表（後述）が記載されているが、その表の小数桁カラムが開始されるセルをA1形式で指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (10) PKカラム開始セル列：(4)のシート名列で指定したシート名にはテーブル定義表（後述）が記載されているが、その表のPKカラムが開始されるセルをA1形式で指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (11) NotNullカラム開始セル列：(4)のシート名列で指定したシート名にはテーブル定義表（後述）が記載されているが、その表のNotNullカラムが開始されるセルをA1形式で指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (12) DBMS列：指定したDBMSの文法でSQLを作成する。コンボボックス選択肢はOracle,SQLServer,SQLite,Accessとする。
- (13) 対象列："〇"or空セルを入力。"〇"の場合は「投入データ」の行を有効として"〇"以外であれば無効とする。無効の場合はSQL作成処理は行わずにその行はスキップする。
- (14) データファイルパス列：ユーザが作成した投入データ定義(Excelファイル)のファイルパスを絶対パスで指定する。対象列かつ不正パス等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (15) シート名列：(14)のファイルパス列のパスが正当な場合、そのExcelファイルのシート名を指定する。シート毎に投入データ定義が指定される。対象列かつ空、不正シート名等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (16) テーブル名列：データを投入するテーブルのテーブル名を指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。
- (17) データ開始セル列：(15)のシート名列で指定したシート名には投入データ定義表（後述）が記載されているが、その表のデータが開始されるセルをA1形式で指定する。対象列かつ空、空セル等の場合はエラーとしてT列のエラーメッセージ列にエラー情報を出力して次行の処理に進む。

9. 8で記載したようにT列のエラーメッセージ列にはエラー情報を出力する。
エラー情報は原因が特定できるように詳細に出力する。（ファイルパス、シート名、不正なセル位置など）

# テーブル定義表について
1. テーブル定義表とは本マクロとは別ファイルで作成するExcelファイルであり、シート毎に1つのテーブルを定義する。

2. テーブル定義表には以下のようなヘッダ行がある。
- No■項目名■型■整数桁■小数桁■PK■NotNull
- (1) No列：1からの連番とするが特に処理には利用しない。
- (2) 項目名列：作成するテーブルのカラム名を記載する。この列が空セルを検知した時点でテーブル定義は終了とする。
- (3) 型列：項目名列の型を記載する。空セルの場合はエラーとする。
- (4) 整数桁列：型列の型が文字型、数値型の場合、その整数桁数を記載する。空セル、数字以外が指定されている場合はエラーとする。
- (5) 小数桁列：型列の型が数値型の場合、その小数桁数を記載する。空セル、数字以外が指定されている場合はエラーとする。
- (6) PK列：項目名列が主キーの場合は空文字以外を指定する。空セルの場合は主キーではないものとする。チェック時にTrimはしない。（つまり半角スペースのみ、全角スペースのみは空文字以外とする）
- (7) NotNull列：項目名列がNotNull制約ありの場合は空文字以外を指定する。空セルの場合はNull許容とする。チェック時にTrimはしない。（つまり半角スペースのみ、全角スペースのみは空文字以外とする）

# 投入データ定義表について
1. 投入データ定義表とは本マクロとは別ファイルで作成するExcelファイルであり、シート毎に1つのテーブル投入データを定義する。

2. 投入データ定義表には以下のようなヘッダ行がある。
No■項目名1■項目名2■・・・項目名n
- (1) No列：1からの連番とする。
この列が空セルを検知した時点で投入データ定義は終了とする。
- (2) 項目名1...n：テーブル定義表の(2) 項目名で定義した名称。テーブル定義表でPK列に指定した項目やNotNull列に指定した項目の場合、空セルはエラーとする。
それ以外のチェックは行わない。（型桁不正は実際にINSERTをDBMSで実行するときにエラーになるので事前のチェックは割愛する）

# 作成SQLについて
1. mainシートの作成ボタンクリックで、テーブル作成SQLおよびデータ投入SQLファイルを作成する。
2. 作成するSQLファイルの命名規則は以下とする。
- テーブル作成SQL：テーブル名_CREATE_YYYYMMDD_hhmmss.sql
- データ投入SQL：テーブル名_INSERT_YYYYMMDD_hhmmss.sql
3. 投入データに環境依存文字が使用されている場合、定数定義された文字に置換する。またエラーメッセージ列に置換した旨を出力する。

#デバッグログについて
1. 定数でON/OFF可能とする。
2. エラーの原因特定をするための詳細な情報をログファイルに出力する。
3. ファイル：SQLCreator_debug.log

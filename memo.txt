
■PoweerShell

<インストール/アップデート>
winget search Microsoft.PowerShell


■Gemini CLI
https://github.com/google-gemini/gemini-cli

<インストール/アップデート>
npm install -g @google/gemini-cli@latest



■Codex CLI
<インストール/アップデート>
npm install -g @openai/codex@latest

<環境構築>
1.WSL2を入れる
2.WSLからnode.js、codexを入れる

<起動方法>
1.PowerShellを管理者権限で開く
2.wsl
3.codex

<バージョン確認>
codex --version

<Tips>
- リポジトリにAGENTS.mdを入れておくとよいらしい。
  そんでもって、指示する前に以下を指示する。
  このディレクトリの AGENTS.md を読んで、記載のルールに従ってください。以後は日本語で説明して。指示があるまではファイルの更新は絶対にしないでください。

  ソースを読んで仕様を理解して、仕様の概要をAGENTS.mdに記載してください。
  ver1.0.6の仕様を追記しましたので、対応をお願いいたします。前バージョンのmdファイルは「AGENTS__old_1.0.5.md」です。
  AGENTS.mdの仕様を全て実装して。
  実装前に疑問点があれば確認してから実装を開始して。


  以下のタスクを、**5行以内で**、**最もシンプルな方法で**実装してください。
  - クラスや関数は必要最小限に。
  - コメント、エラーハンドリング、拡張性は一切不要。
  - 余計な処理や最適化は絶対に追加しない。
  - 動けばOK。


■ステップバイステップ
・各ステップを一気に述べるのではなく、1ステップを提示→そのステップをクリアするまで私とやりとりして
　クリアしたら次のステップに進む・・を繰り返すこと。



■WSL2
# pwdの結果をクリップボードにコピーする

pwd | clip.exe                           Linuxのパス形式でコピー
wslpath -w "$(pwd)" | clip.exe           Windowsのパス形式でコピー



■Visual Studio Community
#起動できなくなったとき：
1. %ProgramFiles(x86)%\Microsoft Visual Studio\Installer\InstallCleanup.exe を管理者権限で実行。
2. コマンド: InstallCleanup.exe -i 17（17 は VS2022 を指定）。
3. PC を再起動後、再インストール。

■Base32で使用される文字 (32文字。A-Z 2-7)
ABCDEFGHIJKLMNOPQRSTUVWXYZ234567


■
アップロードした文字列の画像をテキストにしてください。
ちなみに文字列のフォントはConsolasで、使用している文字種はBase32 + ハイフンのみです。（全て半角文字）



■Maven

# ビルド  ※targetの下にjarが出来る
mvn clean package

# テストはスキップでビルド
mvn clean package -DskipTests

# Springを起動
mvn spring-boot:run 

# テストはスキップ、ログ少なめ（-q）でSpringを起動
mvn -q -DskipTests spring-boot:run

# ライブラリのバージョン確認。以下はSpring Batchの例
mvn dependency:tree | grep spring-batch-core

# ターミナルのエンコードをUTF-8にする（pom.xmlを修正）
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>

            <!-- これを追加 >> -->

            <configuration>
                <jvmArguments>-Dsun.stdout.encoding=UTF-8 -Dfile.encoding=UTF-8</jvmArguments>
            </configuration>

            <!-- これを追加 << -->

        </plugin>
    </plugins>
</build>


■H2   ※メモリ型のDB

# SpringBoot起動時のログに以下が出ていればH2に接続できている状態
HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:testdb user=SA

JavaとH2の型 (代表的なもののみ)
String        → VARCHAR / CLOB
int           → INT
long          → BIGINT
BigDecimal    → DECIMAL
boolean       → BOOLEAN
LocalDate     → DATE
LocalDateTime → TIMESTAMP
byte[]        → BLOB / VARBINARY


■Linux

# 8080ポートを誰がListenしているか?
ss -ltnp | grep 8080

# 全ファイル/フォルダを表示
ls -a



■VS Code

# フォントサイズ
拡大：Ctrl + +
縮小：Ctrl + -
左の歯車 → Settings → Editor: Font Size

# mdファイルをプレビュー  (拡張入れなくもOK)
CTRL + SHIFT + V

# プロジェクトのコピー
cd ~/projects
cp -r src dst
→Mavenの場合、pom.xmlをartifactidを変える

# ファイル検索
画面中央上の虫眼鏡

# ファイル内検索
画面左の虫眼鏡

# BASリロード
Ctrl + Shift + P → "Developer: Reload Window"


■Git

rm -rf .git
git init
git add .
git commit -m "first commit"
git remote add origin https://github.com/mtk57/SoapServerTest2.git
git branch -M main        # GitHub側が main ブランチの場合
git push -u origin main

# clone
1.左のSource ControlのCHANGESの...からclone
2.githubのURLを入れる

# git管理対象をツリー表示
git ls-tree -r --name-only HEAD | tree --fromfile .


■SAP BTP BASのSpring BatchからH2コンソールを使う
1.pom.xmlに以下を追加。(H2はメモリDBなのでバッチのようにアプリが終わってしまう場合はTomCatを常時起動しておく必要がある)
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
  </dependency>

2.application.properties
  spring.h2.console.enabled=true        # H2コンソールを有効
  spring.h2.console.path=/h2-console    # 後で出てくるURLに付けるパス
  spring.h2.console.settings.web-allow-others=true  # H2コンソールを外部からアクセス可能にするか否か

  spring.batch.job.enabled=false        # バッチジョブの自動起動有無。falseだとアプリが起動してもジョブは起動せずWebサーバだけが立ち上がる
                                        # 以下のようなログが出ていなければ自動起動は抑止されている
                                          JobLauncherApplicationRunner : Running default command line with: ...
                                          Job: [SimpleJob: [name=sampleDataJob]] launched with the following parameters: ...
  spring.profiles.active=local          # テスト用/本番用の切り替え

3.ビルドしてアプリを起動する
  ログに以下が出ていればOK
  Tomcat started on port 8080 (http) with context path '/'
  H2 console available at '/h2-console'.

4.Ctrl + Shift + P
  Ports: Preview
  8080
  →ブラウザで新しいタブが勝手に開く
  
5.開いたタブのURLの末尾に
  /h2-console
  →H2コンソールが開く

6.H2コンソールのJDBC URLを
  jdbc:h2:mem:testdb
  にして「Connect」

この方法だとバッチが最後まで走り切った状態のDBを覗くことになるので
バッチが走る前にDBを変更したい場合は、

7.以下のクラスを追加
package com.example.batch_h2_mybatis_chunk_test.web;

import java.time.Instant;
import java.util.HashMap;
import java.util.Map;

import org.springframework.batch.core.Job;
import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersBuilder;
import org.springframework.batch.core.launch.JobLauncher;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Profile("local")
@RestController
public class JobRunController {

    private final JobLauncher jobLauncher;
    private final Job sampleDataJob;

    public JobRunController(JobLauncher jobLauncher, Job sampleDataJob) {
        this.jobLauncher = jobLauncher;
        this.sampleDataJob = sampleDataJob;
    }

    @GetMapping("/run-sample-job")
    public ResponseEntity<String> runJob() throws Exception {
        // ジョブパラメータに時刻を入れて、毎回別ジョブとみなしてもらう
        JobParameters params = new JobParametersBuilder()
                .addLong("runAt", Instant.now().toEpochMilli())
                .toJobParameters();

        jobLauncher.run(sampleDataJob, params);

        return ResponseEntity.ok("sampleDataJob started");
    }
}

8.ビルドして、手順3～6を実施

9.まだジョブは起動していないので、DBを変更しておく。

10.URLの/h2-console以降を
  /run-sample-job
  に変更
  →画面にsampleDataJob startedが出るのでジョブが開始される







----------

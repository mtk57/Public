
■PoweerShell

<インストール/アップデート>
winget search Microsoft.PowerShell


■Gemini CLI
https://github.com/google-gemini/gemini-cli

<インストール/アップデート>
npm install -g @google/gemini-cli@latest



■Codex CLI
<インストール/アップデート>
npm install -g @openai/codex@latest

<環境構築>
1.WSL2を入れる
2.WSLからnode.js、codexを入れる

<起動方法>
1.PowerShellを管理者権限で開く
2.wsl
3.codex

<バージョン確認>
codex --version

<Tips>
- リポジトリにAGENTS.mdを入れておくとよいらしい。
  そんでもって、指示する前に以下を指示する。
  このディレクトリの AGENTS.md を読んで、記載のルールに従ってください。以後は日本語で説明して。指示があるまではファイルの更新は絶対にしないでください。

  ソースを読んで仕様を理解して、仕様の概要をAGENTS.mdに記載してください。
  ver1.0.6の仕様を追記しましたので、対応をお願いいたします。前バージョンのmdファイルは「AGENTS__old_1.0.5.md」です。
  AGENTS.mdの仕様を全て実装して。
  実装前に疑問点があれば確認してから実装を開始して。


  以下のタスクを、**5行以内で**、**最もシンプルな方法で**実装してください。
  - クラスや関数は必要最小限に。
  - コメント、エラーハンドリング、拡張性は一切不要。
  - 余計な処理や最適化は絶対に追加しない。
  - 動けばOK。


■ステップバイステップ
・各ステップを一気に述べるのではなく、1ステップを提示→そのステップをクリアするまで私とやりとりして
　クリアしたら次のステップに進む・・を繰り返すこと。
・1つのステップの中でやることが多すぎないようにすることます。 
　ステップバイステップと指示しているので、1つのステップ内でも1つずつ進めること。


■WSL2
# pwdの結果をクリップボードにコピーする

pwd | clip.exe                           Linuxのパス形式でコピー
wslpath -w "$(pwd)" | clip.exe           Windowsのパス形式でコピー



■Visual Studio Community
#起動できなくなったとき：
1. %ProgramFiles(x86)%\Microsoft Visual Studio\Installer\InstallCleanup.exe を管理者権限で実行。
2. コマンド: InstallCleanup.exe -i 17（17 は VS2022 を指定）。
3. PC を再起動後、再インストール。

■Base32で使用される文字 (32文字。A-Z 2-7)
ABCDEFGHIJKLMNOPQRSTUVWXYZ234567


■
アップロードした文字列の画像をテキストにしてください。
ちなみに文字列のフォントはConsolasで、使用している文字種はBase32 + ハイフンのみです。（全て半角文字）



■Maven

# フェーズの順序
generate-sources → generate-resources → compile → test → package


# ビルド成果物を消して、最初からビルドして成果物をローカルリポジトリ（~/.m2/repository）に登録する （テストはスキップ）
mvn clean install

# ビルド  ※targetの下にjarが出来る
mvn clean package

# ビルド （テストはスキップ）
mvn clean package -DskipTests

# Springを起動
mvn spring-boot:run 

# Springを起動（テストはスキップ、ログ少なめ（-q））
mvn -q -DskipTests spring-boot:run

# Springを起動（テストはスキップ、ログ少なめ（-q）、プロジェクト指定（-pl））
mvn -pl job-01 -q -DskipTests spring-boot:run

# ライブラリのバージョン確認。以下はSpring Batchの例
mvn dependency:tree | grep spring-batch-core

# ターミナルのエンコードをUTF-8にする（pom.xmlを修正）
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>

            <!-- これを追加 >> -->

            <configuration>
                <jvmArguments>-Dsun.stdout.encoding=UTF-8 -Dfile.encoding=UTF-8</jvmArguments>
            </configuration>

            <!-- これを追加 << -->

        </plugin>
    </plugins>
</build>


# JARの中にファイルがあるか確認。
jar tf job-01/target/job-01-0.0.1-SNAPSHOT.jar | grep messages.properties

# 以下のような結果が出れば存在する
BOOT-INF/classes/messages.properties


■H2   ※メモリ型のDB

# SpringBoot起動時のログに以下が出ていればH2に接続できている状態
HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:testdb user=SA

JavaとH2の型 (代表的なもののみ)
String        → VARCHAR / CLOB
int           → INT
long          → BIGINT
BigDecimal    → DECIMAL
boolean       → BOOLEAN
LocalDate     → DATE
LocalDateTime → TIMESTAMP
byte[]        → BLOB / VARBINARY


■Linux

# 8080ポートを誰がListenしているか?
ss -ltnp | grep 8080

# 全ファイル/フォルダを表示
ls -a

# フォルダをzipに
zip -r myproj.zip myproj -x '*/.git/*' '*/target/*' '*/node_modules/*' '*/mta_archives/*' '*/.vscode/*' '*/.gen/*'




■VS Code

# フォントサイズ
拡大：Ctrl + +
縮小：Ctrl + -
左の歯車 → Settings → Editor: Font Size

# mdファイルをプレビュー  (拡張入れなくもOK)
CTRL + SHIFT + V

# プロジェクトのコピー
cd ~/projects
cp -r src dst
→Mavenの場合、pom.xmlをartifactidを変える

# ファイル検索
画面中央上の虫眼鏡

# ファイル内検索
画面左の虫眼鏡

# BASリロード
Ctrl + Shift + P → "Developer: Reload Window"


■Git

rm -rf .git
git init
git add .
git commit -m "first commit"
git remote add origin https://github.com/mtk57/SoapServerTest2.git
git branch -M main        # GitHub側が main ブランチの場合
git push -u origin main

# clone
1.左のSource ControlのCHANGESの...からclone
2.githubのURLを入れる

git clone https://github.com/mtk57/BatchH2MyBatisTest2.git

# git管理対象をツリー表示
git ls-tree -r --name-only HEAD | tree --fromfile .


■Cloud Foundry/HANA Cloud

# HANA Cloud Central に行く手順 (BTP Cokckpit)
1.Instances and Subscriptions
2.SAP HANA Cloud
3.Go to Application


# SAP HANA Cloudを開始する手順
1.HANA Cloud Central → Instances
2.対象インスタンス行の Actions（…） を開く
3.Start


# HANA Cloud Central で接続元IPを許可する手順
1.HANA Cloud Central → Instances
2.対象インスタンス行の Actions（…） を開く
3.Manage Configuration をクリック
4.タブで Connections を開く 
5.Allowed connections（許可する接続）で、次のどちらかを選ぶ
  まず切り分けしたい → Allow all IP addresses（一時的） 
  きちんと制限したい → Allow specific IP addresses and IP ranges
  「Allow specific…」を選んだ場合、許可IP（またはCIDR）を追加
   例：203.0.113.45/32（1つのIPだけ許可）
6.Review / Save（保存）で確定 

HANA Cloud はデフォルトで “全IP拒否” なので、ここを設定しないと外部から基本つながりません。

BAS から接続する場合の注意（ここで詰まりやすい）
許可すべきIPが あなたのPCのグローバルIPではなく、BAS側の出口IP になることがあります。
BASから見える外向きIPを確認
curl -s https://api.ipify.org ; echo

ここで出たIPを /32 を付けて allowlist に入れるのが手早いです。




# SAP HANA Database Explorer
1.HANA Cloud Central → Instances
2.対象インスタンス行の Actions（…） を開く
3.SAP HANA Database Explorer
4.左の「+」でAdd Instance画面を開く
5.Instance Typeで HDI Containerを選ぶ
6.ログインするリンクするみたいなのをクリック












■SAP BTP BASのSpring BatchからH2コンソールを使う
1.pom.xmlに以下を追加。(H2はメモリDBなのでバッチのようにアプリが終わってしまう場合はTomCatを常時起動しておく必要がある)
  <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
  </dependency>

2.application.properties
  spring.main.web-application-type=servlet  # Webサーバとして起動する
  #spring.main.web-application-type=none    # Webサーバとして起動しない(バッチアプリはこれ)

  spring.h2.console.enabled=true                    # H2コンソールを有効
  spring.h2.console.path=/h2-console                # 後で出てくるURLに付けるパス
  spring.h2.console.settings.web-allow-others=true  # H2コンソールを外部からアクセス可能にするか否か

  spring.batch.job.enabled=false        # バッチジョブの自動起動有無。falseだとアプリが起動してもジョブは起動せずWebサーバだけが立ち上がる
                                        # 以下のようなログが出ていなければ自動起動は抑止されている
                                          JobLauncherApplicationRunner : Running default command line with: ...
                                          Job: [SimpleJob: [name=sampleDataJob]] launched with the following parameters: ...
  spring.profiles.active=local          # テスト用/本番用の切り替え
  #spring.profiles.active=cloud         # テスト用/本番用の切り替え

3.ビルドしてアプリを起動する
  ログに以下が出ていればOK
  Tomcat started on port 8080 (http) with context path '/'
  H2 console available at '/h2-console'.

4.Ctrl + Shift + P
  Ports: Preview
  8080
  →ブラウザで新しいタブが勝手に開く
  
5.開いたタブのURLの末尾に
  /h2-console
  →H2コンソールが開く

6.H2コンソールのJDBC URLを
  jdbc:h2:mem:testdb
  にして「Connect」

この方法だとバッチが最後まで走り切った状態のDBを覗くことになるので
バッチが走る前にDBを変更したい場合は、

7.以下のクラスを追加
package com.example.batch_h2_mybatis_chunk_test.web;

import java.time.Instant;
import java.util.HashMap;
import java.util.Map;

import org.springframework.batch.core.Job;
import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersBuilder;
import org.springframework.batch.core.launch.JobLauncher;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Profile("local")
@RestController
public class JobRunController {

    private final JobLauncher jobLauncher;
    private final Job sampleDataJob;

    public JobRunController(JobLauncher jobLauncher, Job sampleDataJob) {
        this.jobLauncher = jobLauncher;
        this.sampleDataJob = sampleDataJob;
    }

    @GetMapping("/run-sample-job")
    public ResponseEntity<String> runJob() throws Exception {
        // ジョブパラメータに時刻を入れて、毎回別ジョブとみなしてもらう
        JobParameters params = new JobParametersBuilder()
                .addLong("runAt", Instant.now().toEpochMilli())
                .toJobParameters();

        jobLauncher.run(sampleDataJob, params);

        return ResponseEntity.ok("sampleDataJob started");
    }
}

8.ビルドして、手順3～6を実施

9.まだジョブは起動していないので、DBを変更しておく。

10.URLの/h2-console以降を
  /run-sample-job
  に変更
  →画面にsampleDataJob startedが出るのでジョブが開始される

11.元に戻すときは
   application.propertiesから以下をコメントアウト
   #spring.h2.console.enabled=true
   #spring.h2.console.path=/h2-console
   #spring.h2.console.settings.web-allow-others=true
   #spring.batch.job.enabled=false

   #spring.main.web-application-type=servlet
   spring.main.web-application-type=none

----------
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
